@model Gauniv.WebServer.Models.AdminGamesViewModel
@{
    ViewData["Title"] = "Game Management";
}

<div class="admin-breadcrumb">
    <a href="@Url.Action("Index", "Admin")">Dashboard</a>
    <i class="bi bi-chevron-right" style="font-size: 0.7rem;"></i>
    <span>Game Management</span>
</div>

<div class="d-flex align-items-center justify-content-between mb-4">
    <div class="d-flex align-items-center gap-3">
        <form method="get" asp-action="Games" class="search-box" style="width: 300px;">
            <i class="bi bi-search search-icon"></i>
            <input type="text" name="search" class="form-control" placeholder="Search games..."
                   value="@Model.SearchQuery">
        </form>
        <span class="text-muted" style="font-size: 0.85rem;">@Model.TotalCount games total</span>
    </div>
    <a href="@Url.Action("CreateGame", "Admin")" class="btn btn-admin btn-admin-primary">
        <i class="bi bi-plus-lg me-1"></i>Add Game
    </a>
</div>

<div class="admin-table">
    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Game Name</th>
                <th>Price</th>
                <th>Size</th>
                <th>Category</th>
                <th>Owners</th>
                <th>Created At</th>
                <th style="width: 160px;">Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var local_game in Model.Games)
            {
                <tr>
                    <td class="text-muted">#@local_game.Id</td>
                    <td class="fw-medium">@local_game.Name</td>
                    <td><span class="fw-medium" style="color: #059669;">@local_game.Price.ToString("F2") â‚¬</span></td>
                    <td class="text-muted">@FormatSize(local_game.Size)</td>
                    <td>
                        @string.Join(", ", local_game.CategoryNames)
                    </td>
                    <td class="fw-medium">@local_game.OwnerCount</td>
                    <td class="text-muted" style="font-size: 0.85rem;">@local_game.CreatedAt.ToString("yyyy-MM-dd HH:mm")</td>
                    <td>
                        <div class="d-flex gap-2">
                            <a href="@Url.Action("EditGame", "Admin", new { id = local_game.Id })"
                               class="btn btn-admin btn-admin-warning" style="font-size: 0.78rem; padding: 5px 10px;">
                                <i class="bi bi-pencil"></i> Edit
                            </a>
                            <form method="post" action="@Url.Action("DeleteGame", "Admin", new { id = local_game.Id })"
                                  onsubmit="return confirm('Are you sure you want to delete game &quot;@local_game.Name&quot;? This action cannot be undone!')">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-admin btn-admin-danger" style="font-size: 0.78rem; padding: 5px 10px;">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
            }
            @if (!Model.Games.Any())
            {
                <tr>
                    <td colspan="8" class="text-center text-muted py-5">
                        <i class="bi bi-inbox" style="font-size: 2rem; display: block; margin-bottom: 8px;"></i>
                        No games yet
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@if (Model.TotalPages > 1)
{
    <nav class="mt-4 d-flex justify-content-center">
        <ul class="pagination">
            @for (int local_i = 1; local_i <= Model.TotalPages; local_i++)
            {
                <li class="page-item @(local_i == Model.CurrentPage ? "active" : "")">
                    <a class="page-link" href="@Url.Action("Games", "Admin", new { page = local_i, search = Model.SearchQuery })"
                       style="border-radius: 8px; margin: 0 2px; @(local_i == Model.CurrentPage ? "background: #3b82f6; border-color: #3b82f6;" : "")">
                        @local_i
                    </a>
                </li>
            }
        </ul>
    </nav>
}

@functions {
    static string FormatSize(long bytes)
    {
        if (bytes >= 1073741824) return $"{bytes / 1073741824.0:F2} GB";
        if (bytes >= 1048576) return $"{bytes / 1048576.0:F2} MB";
        if (bytes >= 1024) return $"{bytes / 1024.0:F2} KB";
        return $"{bytes} B";
    }
}
